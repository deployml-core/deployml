name: monitoring-demo-stack
provider:
  name: gcp
  project_id: mldeploy-468919
  region: us-west1

deployment:
  type: cloud_run

stack:
  # MLflow for experiment tracking and model registry
  - experiment_tracking:
      name: mlflow
      params:
        image: gcr.io/mldeploy-468919/mlflow-server:latest
        service_name: mlflow-server

  - artifact_tracking:
      name: mlflow
      params:
        image: gcr.io/mldeploy-468919/mlflow-server:latest
        
  - model_registry:
      name: mlflow
      params:
        image: gcr.io/mldeploy-468919/mlflow-server:latest
        backend_store_uri: postgresql

  # Feast feature store (custom build)
  - feature_store:
      name: feast
      params:
        image: gcr.io/mldeploy-468919/feast-server:latest
        service_name: feast-server
        backend_store_uri: sqlite
        offline_store: file

  # FastAPI for model serving with prediction logging
  - model_serving:
      name: fastapi
      params:
        image: gcr.io/mldeploy-468919/fastapi-serving:latest
        service_name: house-price-api

  # Grafana for monitoring dashboard
  - model_monitoring:
      name: grafana
      params:
        image: gcr.io/mldeploy-468919/grafana-server:latest
        service_name: grafana-dashboard

  # Scheduled jobs for offline scoring, drift, explainability, and fairness monitoring
  - workflow_orchestration:
      name: cron
      params:
        jobs:
          # Offline batch scoring - runs twice a month
          - service_name: offline-scoring
            image: gcr.io/mldeploy-468919/offline-scoring:latest
            cron_schedule: "0 2 1,15 * *"  # 2 AM on 1st and 15th of month
            bigquery_dataset: feast_monitoring
          
          # Drift monitoring - runs daily
          - service_name: drift-monitoring
            image: gcr.io/mldeploy-468919/drift-monitoring:latest
            cron_schedule: "0 6 * * *"  # Daily at 6 AM
            bigquery_dataset: feast_monitoring
          
          # Explainability monitoring - runs daily
          - service_name: explainability-monitoring
            image: gcr.io/mldeploy-468919/explainability-monitor:latest
            cron_schedule: "0 7 * * *"  # Daily at 7 AM
            bigquery_dataset: feast_monitoring
          
          # Fairness monitoring - runs daily
          - service_name: fairness-monitoring
            image: gcr.io/mldeploy-468919/fairness-checker:latest
            cron_schedule: "0 8 * * *"  # Daily at 8 AM
            bigquery_dataset: feast_monitoring

